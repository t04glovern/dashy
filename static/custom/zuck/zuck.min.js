/* zuck.js - https://github.com/ramon82/zuck.js */
window.ZuckitaDaGalera=window.Zuck=function(t,z){var u=document,c=this;"string"==typeof t&&(t=u.getElementById(t));var l=function(a){return u.querySelectorAll(a)[0]},f=function(a,b){return a?a[b]||"":""},r=function(a,b){if(a)for(var d=a.length,g=0;g<d;g++)b(g,a[g])},A=function(a,b,d){b=[b.toLowerCase(),"webkit"+b,"MS"+b,"o"+b];r(b,function(b,c){a[c]=d})},L=function(a,b,d){d=[d.toLowerCase(),"webkit"+d,"MS"+d,"o"+d];r(d,function(d,c){a.addEventListener(c,b,!1)})},M=function(a,b){L(a,b,"AnimationEnd")},
S=function(a,b){a.transitionEndEvent||(a.transitionEndEvent=!0,L(a,b,"TransitionEnd"))},D=function(a,b){a.firstChild?a.insertBefore(b,a.firstChild):a.appendChild(b)},N=function(a,b){if(b)document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else try{a.requestFullScreen?a.requestFullScreen():a.msRequestFullScreen?a.msRequestFullScreen():a.mozRequestFullScreen?a.mozRequestFullScreen():
a.webkitRequestFullScreen&&a.webkitRequestFullScreen()}catch(d){}},C=function(a,b,d,g){var c=0<b?1:-1,c=Math.abs(b)/l("#zuck-modal").offsetWidth*90*c;if(k("cubeEffect")){var h=0==c?"scale(0.95)":"scale(0.930,0.930)";A(l("#zuck-modal-content").style,"Transform",h);if(-90>c||90<c)return!1}b=k("cubeEffect")?"rotateY("+c+"deg)":"translate3d("+b+"px, 0, 0)";a&&(A(a.style,"TransitionTimingFunction",g),A(a.style,"TransitionDuration",d+"ms"),A(a.style,"Transform",b))},E=function(a,b,d,c){var g=0,h=0;if(a){if(a.offsetParent){do if(g+=
a.offsetLeft,h+=a.offsetTop,a==c)break;while(a=a.offsetParent)}b&&(h-=b);d&&(g-=d)}return[g,h]},F=function(a){a=1E3*Number(a);var b=k("language","time"),c=[[60,b.seconds,1],[120,"1"+b.minute,""],[3600,b.minutes,60],[7200,"1"+b.hour,""],[86400,b.hours,3600],[172800,b.yesterday,""],[604800,b.days,86400]],g=(""+a).replace(/-/g,"/").replace(/[TZ]/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"");"."==g.substr(g.length-4,1)&&(g=g.substr(0,g.length-4));isNaN((new Date(g)).getDate())&&(g=a);a=(new Date-new Date(g))/
1E3;var f=b.ago,h=1;0>a&&(a=Math.abs(a),f=b.ago,h=2);for(var b=0,e;e=c[b++];)if(a<e[0])return"string"==typeof e[2]?e[h]:Math.floor(a/e[2])+" "+e[1]+" "+f;return g},m=t.id,G={skin:"snapgram",avatars:!0,stories:[],backButton:!0,backNative:!1,autoFullScreen:!1,openEffect:!0,cubeEffect:!1,list:!1,localStorage:!0,callbacks:{onOpen:function(a,b){b()},onView:function(a){},onEnd:function(a,b){b()},onClose:function(a,b){b()},onNextItem:function(a,b,c){c()}},language:{unmute:"Touch to unmute",keyboardTip:"Press space to see next",
visitLink:"Visit link",time:{ago:"ago",hour:"hour",hours:"hours",minute:"minute",minutes:"minutes",fromnow:"from now",seconds:"seconds",yesterday:"yesterday",tomorrow:"tomorrow",days:"days"}}},k=function(a,b){var c=function(a){return"undefined"!==typeof a};return b?c(z[a])?c(z[a][b])?z[a][b]:G[a][b]:G[a][b]:c(z[a])?z[a]:G[a]},y=new function(){var a=f("#zuck-modal");a||(a=u.createElement("div"),a.id="zuck-modal",k("cubeEffect")&&(a.className="with-cube"),a.innerHTML='<div id="zuck-modal-content"></div>',
a.style.display="none",a.setAttribute("tabIndex","1"),a.onkeyup=function(a){a=a.keyCode;27==a?y.close():13!=a&&32!=a||y.next()},k("openEffect")&&a.classList.add("with-effects"),S(a,function(){a.classList.contains("closed")&&(b.innerHTML="",a.style.display="none",a.classList.remove("closed"),a.classList.remove("animated"))}),u.body.appendChild(a));var b=l("#zuck-modal-content"),d=function(b){var e="",h="",d="0",f=l("#zuck-modal-slider-"+m),q={previous:l("#zuck-modal .story-viewer.previous"),next:l("#zuck-modal .story-viewer.next"),
viewing:l("#zuck-modal .story-viewer.viewing")};if(!q.previous&&!b||!q.next&&b)return!1;b?(e="next",h="previous"):(e="previous",h="next");k("cubeEffect")?"previous"==e?d=a.slideWidth:"next"==e&&(d=-1*a.slideWidth):(d=E(q[e]),d=-1*d[0]);C(f,d,600,null);setTimeout(function(){if(""!=e&&q[e]&&""!=h){var a=q[e].getAttribute("data-story-id");c.internalData.currentStory=a;(a=l("#zuck-modal .story-viewer."+h))&&a.parentNode.removeChild(a);q.viewing&&(q.viewing.classList.add("stopped"),q.viewing.classList.add(h),
q.viewing.classList.remove("viewing"));q[e]&&(q[e].classList.remove("stopped"),q[e].classList.remove(e),q[e].classList.add("viewing"));(a=H(e))&&g(a,e);var a=c.internalData.currentStory,b=l('#zuck-modal [data-story-id="'+a+'"]');if(b){var b=b.querySelectorAll("[data-index].active"),d=b[0].firstElementChild;c.data[a].currentItem=parseInt(b[0].getAttribute("data-index"),10);b[0].innerHTML='<b style="'+d.style.cssText+'"></b>';M(b[0].firstElementChild,function(){c.nextItem(!1)})}C(f,"0",0,null);b&&I([b[0],
b[1]],!0);k("callbacks","onView")(c.internalData.currentStory)}},650)},g=function(a,b,d){var e=l("#zuck-modal-slider-"+m),g="",h="",v=f(a,"id"),p=u.createElement("div"),B=f(a,"currentItem")||0,x="";if(l('#zuck-modal .story-viewer[data-story-id="'+v+'"]'))return!1;p.className="slides";r(f(a,"items"),function(b,c){B>b&&(a.items[b].seen=!0,c.seen=!0);var d=f(c,"length"),e=f(c,"linkText"),l=!0===f(c,"seen")?"seen":"",v='data-index="'+b+'" data-item-id="'+f(c,"id")+'"';B===b&&(x=F(f(c,"time")));h+="<span "+
v+' class="'+(B===b?"active":"")+" "+l+'"><b style="animation-duration:'+(""===d?"3":d)+'s"></b></span>';g+='<div data-time="'+f(c,"time")+'" data-type="'+f(c,"type")+'"'+v+' class="item '+l+" "+(B===b?"active":"")+'">'+("video"===f(c,"type")?'<video class="media" muted webkit-playsinline playsinline preload="auto" src="'+f(c,"src")+'" '+f(c,"type")+'></video><b class="tip muted">'+k("language","unmute")+"</b>":'<img class="media" src="'+f(c,"src")+'" '+f(c,"type")+">")+(f(c,"link")?'<a class="tip link" href="'+
f(c,"link")+'" rel="noopener" target="_blank">'+(""==e?k("language","visitLink"):e)+"</a>":"")+"</div>"});p.innerHTML=g;var w=p.querySelector("video"),J=function(a){a.muted?n.classList.add("muted"):n.classList.remove("muted")};w&&(w.onwaiting=function(a){w.paused&&(n.classList.add("paused"),n.classList.add("loading"))},w.onplay=function(){J(w);n.classList.remove("stopped");n.classList.remove("paused");n.classList.remove("loading")},w.onready=w.onload=w.onplaying=w.oncanplay=function(){J(w);n.classList.remove("loading")},
w.onvolumechange=function(){J(w)});var n=u.createElement("div");n.className="story-viewer muted "+b+" "+(d?"":"stopped")+" "+(k("backButton")?"with-back-button":"");n.setAttribute("data-story-id",v);d='<div class="head"><div class="left">'+(k("backButton")?'<a class="back">&lsaquo;</a>':"")+'<u class="img" style="background-image:url('+f(a,"photo")+');"></u><div><strong>'+f(a,"name")+'</strong><span class="time">'+x+'</span></div></div><div class="right"><span class="time">'+x+'</span><span class="loading"></span><a class="close" tabIndex="2">&times;</a></div></div><div class="slides-pointers"><div>'+
h+"</div></div>";n.innerHTML=d;r(n.querySelectorAll(".close, .back"),function(a,b){b.onclick=function(a){a.preventDefault();y.close()}});n.appendChild(p);"viewing"==b&&I(n.querySelectorAll('[data-index="'+B+'"].active'),!1);r(n.querySelectorAll(".slides-pointers [data-index] > b"),function(a,b){M(b,function(){c.nextItem(!1)})});"previous"==b?D(e,n):e.appendChild(n)},p=function(b){var e,g,f,h,k,p,m=function(c){var d=l("#zuck-modal .viewing");if("A"==c.target.nodeName)return!0;c.preventDefault();c=
c.touches?c.touches[0]:c;var n=E(l("#zuck-modal .story-viewer.viewing"));a.slideWidth=l("#zuck-modal .story-viewer").offsetWidth;e=n[0];g={x:c.pageX,y:c.pageY,time:Date.now()};f=void 0;h={};b.addEventListener("mousemove",r);b.addEventListener("mouseup",x);b.addEventListener("mouseleave",x);b.addEventListener("touchmove",r);b.addEventListener("touchend",x);d&&d.classList.add("paused");T();k=setTimeout(function(){d.classList.add("longPress")},600);p=setTimeout(function(){clearInterval(p);p=!1},250)},
r=function(a){var c=a.touches?a.touches[0]:a,d=c.pageX,c=c.pageY;g&&(h={x:d-g.x,y:c-g.y},"undefined"===typeof f&&(f=!!(f||Math.abs(h.x)<Math.abs(h.y))),!f&&g&&(a.preventDefault(),C(b,e+h.x,0,null)))},x=function(v){var m=l("#zuck-modal .viewing");if(h){u.querySelectorAll("#zuck-modal .story-viewer");var n=g?Date.now()-g.time:void 0,n=300>Number(n)&&25<Math.abs(h.x)||Math.abs(h.x)>a.slideWidth/3,q=0>h.x,O=q?l("#zuck-modal .story-viewer.next"):l("#zuck-modal .story-viewer.previous");f||(!n||q&&!O||!q&&
!O?C(b,e,300):d(q,!0));g=void 0;b.removeEventListener("mousemove",r);b.removeEventListener("mouseup",x);b.removeEventListener("mouseleave",x);b.removeEventListener("touchmove",r);b.removeEventListener("touchend",x)}n=c.internalData.currentVideoElement;k&&clearInterval(k);m&&(m.classList.remove("longPress"),m.classList.remove("paused"));if(p)if(clearInterval(p),p=!1,(m=l("#zuck-modal .viewing"))&&n)m.classList.contains("muted")?P(n,m):c.nextItem(v);else return c.nextItem(v),!1};b.addEventListener("touchstart",
m);b.addEventListener("mousedown",m)};return{show:function(d,e){k("callbacks","onOpen")(d,function(){b.innerHTML='<div id="zuck-modal-slider-'+m+'" class="slider"></div>';var e=c.data[d],f=e.currentItem||0,h=l("#zuck-modal-slider-"+m);p(h);c.internalData.currentStory=d;e.currentItem=f;k("backNative")&&(location.hash="#!"+m);(f=H("previous"))&&g(f,"previous");g(e,"viewing",!0);(e=H("next"))&&g(e,"next");k("autoFullScreen")&&a.classList.add("fullscreen");var q=function(){a.classList.contains("fullscreen")&&
k("autoFullScreen")&&1024>=window.screen.width&&N(a);a.focus()};k("openEffect")?(e=l("#"+m+' [data-id="'+d+'"] .img'),f=E(e),a.style.marginLeft=f[0]+e.offsetWidth/2+"px",a.style.marginTop=f[1]+e.offsetHeight/2+"px",a.style.display="block",a.slideWidth=l("#zuck-modal .story-viewer").offsetWidth,setTimeout(function(){a.classList.add("animated")},10),setTimeout(function(){q()},300)):(a.style.display="block",a.slideWidth=l("#zuck-modal .story-viewer").offsetWidth,q());k("callbacks","onView")(d)})},next:function(a){k("callbacks",
"onEnd")(c.internalData.currentStory,function(){var a=c.internalData.currentStory,b=l("#"+m+' [data-id="'+a+'"]');b&&(b.classList.add("seen"),c.data[a].seen=!0,c.internalData.seenItems[a]=!0,Q("seenItems",c.internalData.seenItems),K());l("#zuck-modal .story-viewer.next")?d(!0):y.close()})},close:function(){k("callbacks","onClose")(c.internalData.currentStory,function(){k("backNative")&&(location.hash="");N(a,!0);k("openEffect")?a.classList.add("closed"):(b.innerHTML="",a.style.display="none")})}}},
U=function(a){a=a.getAttribute("data-id");var b=u.querySelectorAll("#"+m+' [data-id="'+a+'"] .items > li'),d=[];r(b,function(a,b){var c=b.firstElementChild,e=c.firstElementChild;d.push({src:c.getAttribute("href"),length:c.getAttribute("data-length"),type:c.getAttribute("data-type"),time:c.getAttribute("data-time"),link:c.getAttribute("data-link"),preview:e.getAttribute("src")})});c.data[a].items=d},R=function(a){var b=a.getAttribute("data-id"),d=!1;c.internalData.seenItems[b]&&(d=!0);d?a.classList.add("seen"):
a.classList.remove("seen");try{c.data[b]={id:b,photo:a.getAttribute("data-photo"),name:a.firstElementChild.lastElementChild.firstChild.innerText,link:a.firstElementChild.getAttribute("href"),lastUpdated:a.getAttribute("data-last-updated"),seen:d,items:[]}}catch(g){c.data[b]={items:[]}}a.onclick=function(a){a.preventDefault();y.show(b)}},H=function(a){var b=c.internalData.currentStory;a+="ElementSibling";return b&&(b=l("#"+m+' [data-id="'+b+'"]')[a])?(b=b.getAttribute("data-id"),c.data[b]||!1):!1},
K=function(){r(u.querySelectorAll("#"+m+" .story.seen"),function(a,b){var d=c.data[b.getAttribute("data-id")];b.parentNode.removeChild(b);c.add(d,!0)})},I=function(a,b){var d=a[1],g=a[0],f=g.parentNode.parentNode.parentNode;if(!d||!g)return!1;var h=c.internalData.currentVideoElement;h&&h.pause();if("video"==d.getAttribute("data-type")){var e=d.getElementsByTagName("video")[0];if(!e)return c.internalData.currentVideoElement=!1;d=function(){e.duration&&A(g.getElementsByTagName("b")[0].style,"AnimationDuration",
e.duration+"s")};d();e.addEventListener("loadedmetadata",d);c.internalData.currentVideoElement=e;e.currentTime=0;e.play();b.target&&P(e,f)}else c.internalData.currentVideoElement=!1},T=function(){var a=c.internalData.currentVideoElement;if(a)try{a.pause()}catch(b){}},P=function(a,b){a.muted=!1;a.volume=1;a.removeAttribute("muted");a.play();a.paused&&(a.muted=!0,a.play());b&&b.classList.remove("paused")},Q=function(a,b){try{k("localStorage")&&(window.localStorage["zuck-"+m+"-"+a]=JSON.stringify(b))}catch(d){}};
c.data={};c.internalData={};c.internalData.seenItems=function(a){return k("localStorage")?(a="zuck-"+m+"-"+a,window.localStorage[a]?JSON.parse(window.localStorage[a]):!1):!1}("seenItems")||{};c.add=c.update=function(a,b){var d=f(a,"id"),g=l("#"+m+' [data-id="'+d+'"]'),p="",h=f(a,"items"),e=!1;c.data[d]={};g?e=g:(e=u.createElement("div"),e.className="story");!1===a.seen&&(c.internalData.seenItems[d]=!1,Q("seenItems",c.internalData.seenItems));e.setAttribute("data-id",d);e.setAttribute("data-photo",
f(a,"photo"));e.setAttribute("data-last-updated",f(a,"lastUpdated"));p=!1;h[0]&&(p=h[0].preview||"");p='<a href="'+f(a,"link")+'"><span class="img"><u style="background-image:url('+(k("avatars")||!p||""==p?f(a,"photo"):p)+')"></u></span><span class="info"><strong>'+f(a,"name")+'</strong><span class="time">'+F(f(a,"lastUpdated"))+'</span></span></a><ul class="items"></ul>';e.innerHTML=p;R(e);g||(b?t.appendChild(e):D(t,e));r(h,function(a,e){c.addItem(d,e,b)});b||K()};c.next=function(){y.next()};c.addItem=
function(a,b,c){a=l("#"+m+' > [data-id="'+a+'"]');var d=u.createElement("li");d.className=f(b,"seen")?"seen":"";d.setAttribute("data-id",f(b,"id"));d.innerHTML='<a href="'+f(b,"src")+'" data-link="'+f(b,"link")+'" data-time="'+f(b,"time")+'" data-type="'+f(b,"type")+'" data-length="'+f(b,"length")+'"><img src="'+f(b,"preview")+'"></a>';b=a.querySelectorAll(".items")[0];c?b.appendChild(d):D(b,d);U(a)};c.removeItem=function(a,b){var c=l("#"+m+' > [data-id="'+a+'"] [data-id="'+b+'"]');t.parentNode.removeChild(c)};
c.nextItem=function(a){var b=c.internalData.currentStory,d=c.data[b].currentItem,f=l('#zuck-modal .story-viewer[data-story-id="'+b+'"]');if(!f||1==f.touchMove)return!1;var m=f.querySelectorAll('[data-index="'+d+'"]'),h=m[0],e=m[1],v=f.querySelectorAll('[data-index="'+(d+1)+'"]'),u=v[0],t=v[1];f&&u&&t?k("callbacks","onNextItem")(b,t.getAttribute("data-story-id"),function(){h.classList.remove("active");h.classList.add("seen");e.classList.remove("active");e.classList.add("seen");u.classList.remove("seen");
u.classList.add("active");t.classList.remove("seen");t.classList.add("active");r(f.querySelectorAll(".time"),function(a,b){b.innerText=F(t.getAttribute("data-time"))});c.data[b].currentItem++;I(v,a)}):f&&y.next(a)};return function(){location.hash=="#!"+m&&(location.hash="");l("#"+m+" .story")&&r(t.querySelectorAll(".story"),function(a,b){R(b,!0)});k("backNative")&&window.addEventListener("popstate",function(a){location.hash!="#!"+m&&(location.hash="")},!1);r(k("stories"),function(a,b){c.add(b,!0)});
K();var a=k("avatars")?"user-icon":"story-preview",b=k("list")?"list":"carousel";t.className="stories "+a+" "+b+" "+(k("skin")+"").toLowerCase();return c}()};
